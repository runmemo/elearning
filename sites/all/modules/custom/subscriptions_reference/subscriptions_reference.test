<?php

/**
 * @file
 * Contains test cases for subscriptions reference module
 */

/** 
 * Class contains tests 
 * @todo barinder implement tests
 */
class SubscriptionReferenceTestCase extends DrupalWebTestCase {
  
  
  function setUp() {
    parent::setUp('subscriptions_reference_test');
    // create user A (uA)
    
    // create user B (uB)
    
    // create parent node (nP) as uA
    
    // 
  }
  
  /**
   * Tests subscribe functions used by rules
   * @see subscriptions_reference.rules.inc 
   * @see subscriptions_reference_subscribe()
   * @see subscriptions_reference_unsubscribe()
   * 
   */
  function testSubscribeRules() {
    // subscriptions_reference_subscribe()
    
    
    // subscriptions_reference_unsubscribe()
  }
  
  
  /**
   * @see subscriptions_reference_test.module in tests
   */
  function testUserGetsNotification() {
    
    // create child (nC) for nP as uB
     
    // check if that and only that email is in the queue (uA is autosubscribed)
    
    // run cron
    
    // check that email is sent
    $this->drupalGetMails(); // ?
    
    // create answer to nP as user A
    
    // check if email is not in the queue
    
    // unsubscribe uA from nP
    
    // create child to nP as uB
    
    // check that email is not in the queue
    
    // run cron
    
    // check that email is sent
    
    // subscribe user B to node Parent
    
    // add child to Parent node as user C
    
    // check that only user B gets notification
    
  }
  
}

class SubscriptionReferenceUnitTestCase extends DrupalUnitTestCase {
  
  public static function getInfo() {
    return array(
      'name' => 'Subscription Reference Unit Test Case',
      'description' => 'Unit tests for subscription reference.',
      'group' => 'Subscription Reference',
    );
  }
  
  function test_hook_subscriptions_reference() {
    //  @todo find a way to mock the function _available_reference_fields() 
    //  override_function(); this is one possible solution
    //  http://php.net/manual/en/function.override-function.php
    //  http://www.php.net/manual/en/function.override-function.php#50821
    //  that requires: pecl apd
    
    //  overriding of the function will allow testing of other functions
    //  without touching db
    
    //  here is an example of mock testing:
    //  http://www.workhabit.com/blog/mock-function-testing-drupal
    //  that requires: pecl runkit
  }
}